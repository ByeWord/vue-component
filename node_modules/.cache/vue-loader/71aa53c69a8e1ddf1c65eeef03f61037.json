{"remainingRequest":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\src\\components\\scroll-view\\src\\scroll-view.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\src\\components\\scroll-view\\src\\scroll-view.vue","mtime":1584426134947},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7Y2FsVmlzaWJsZUhlaWdodH0gZnJvbSAiLi4vLi4vLi4vdXRpbHMvc2Nyb2xsIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJXU2Nyb2xsVmlldyIsCiAgcHJvcHM6IHsKICAgIHN0ZXA6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAxMDAKICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0cmFja0hlaWdodDogMCwKICAgICAgc2Nyb2xsQmFySGVpZ2h0OiAwLAogICAgICBzY3JvbGxCYXJWaXNpYmxlOiB0cnVlLAogICAgICBzY3JvbGxCYXJTdGFydFBvczoge30sCiAgICAgIHNjcm9sbEJhck1vdmluZzogZmFsc2UsCiAgICAgIHNjcm9sbEJhclRyYW5zbGF0ZToge3g6IDAsIHk6IDAsIHo6IDF9LAogICAgICBjb250ZW50VHJhbnNsYXRlWTogMCwKICAgICAgY29udGVudEhlaWdodDogMCwKICAgICAgdmlzaWJsZUhlaWdodDogMCwKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBjb250ZW50TWF4VHJhbnNsYXRlWSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udGVudEhlaWdodCAtIHRoaXMudmlzaWJsZUhlaWdodDsKICAgIH0sCiAgICBzY3JvbGxCYXJNYXhUcmFuc2xhdGVZKCkgewogICAgICByZXR1cm4gdGhpcy50cmFja0hlaWdodCAtIHRoaXMuc2Nyb2xsQmFySGVpZ2h0OwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgbGlzdGVuVG9SZW1vdGVSZXNvdXJjZXMoKSB7CiAgICAgIGxldCB0YWdzID0gdGhpcy4kcmVmcy52aWV3Qm94LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZywgdmlkZW8sIGF1ZGlvJyk7CiAgICAgIEFycmF5LmZyb20odGFncykubWFwKCh0YWcpID0+IHsKICAgICAgICBpZiAodGFnLmhhc0F0dHJpYnV0ZSgnZGF0YS1saXN0ZW5lZCcpKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgdGFnLnNldEF0dHJpYnV0ZSgnZGF0YS1saXN0ZW5lZCcsICd5ZXMnKTsKICAgICAgICB0YWcuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHsKICAgICAgICAgIHRoaXMuaW5pdCgpOwogICAgICAgIH0pCiAgICAgIH0pCiAgICB9LAogICAgbGlzdGVuVG9Eb21DaGFuZ2UoKSB7CiAgICAgIGNvbnN0IHRhcmdldE5vZGUgPSB0aGlzLiRyZWZzLmNvbnRlbnQ7CiAgICAgIGNvbnN0IGNvbmZpZyA9IHthdHRyaWJ1dGVzOiB0cnVlLCBjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9OwogICAgICBjb25zdCBjYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGlzLmxpc3RlblRvUmVtb3RlUmVzb3VyY2VzKCkKICAgICAgfTsKICAgICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihjYWxsYmFjayk7CiAgICAgIG9ic2VydmVyLm9ic2VydmUodGFyZ2V0Tm9kZSwgY29uZmlnKTsKICAgIH0sCiAgICB1cGRhdGVTY3JvbGxCYXJIZWlnaHQoKSB7CiAgICAgIHRoaXMuc2Nyb2xsQmFySGVpZ2h0ID0gdGhpcy52aXNpYmxlSGVpZ2h0ICogdGhpcy50cmFja0hlaWdodCAvIHRoaXMuY29udGVudEhlaWdodDsKICAgIH0sCiAgICB1cGRhdGVTY3JvbGxCYXIoKSB7CiAgICAgIHRoaXMudXBkYXRlU2Nyb2xsQmFySGVpZ2h0KCk7CiAgICAgIHRoaXMuc2Nyb2xsQmFyVHJhbnNsYXRlLnkgPSAtdGhpcy5jb250ZW50VHJhbnNsYXRlWSAqIHRoaXMudHJhY2tIZWlnaHQgLyB0aGlzLmNvbnRlbnRIZWlnaHQ7CiAgICB9LAogICAgdXBkYXRlQ29udGVudFRyYW5zbGF0ZVlCeU1vdXNlKCkgewogICAgICB0aGlzLmNvbnRlbnRUcmFuc2xhdGVZID0gLXRoaXMuY29udGVudEhlaWdodCAqIHRoaXMuc2Nyb2xsQmFyVHJhbnNsYXRlLnkgLyB0aGlzLnZpc2libGVIZWlnaHQ7CiAgICB9LAogICAgb25Nb3VzZURvd25TY3JvbGxCYXIoZSkgewogICAgICB0aGlzLnNjcm9sbEJhck1vdmluZyA9IHRydWU7CiAgICAgIHRoaXMuc2Nyb2xsQmFyU3RhcnRQb3MgPSB7eDogZS5wYWdlWCwgeTogZS5wYWdlWX07CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMub25Nb3VzZU1vdmVTY3JvbGxCYXIpOwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbk1vdXNlVXBTY3JvbGxCYXIpOwogICAgfSwKICAgIG9uTW91c2VNb3ZlU2Nyb2xsQmFyKGUpIHsKICAgICAgaWYgKHRoaXMuc2Nyb2xsQmFyTW92aW5nKSB7CiAgICAgICAgbGV0IGRlbHRhWSA9IGUucGFnZVkgLSB0aGlzLnNjcm9sbEJhclN0YXJ0UG9zLnk7CiAgICAgICAgdGhpcy5zY3JvbGxCYXJTdGFydFBvcyA9IHt4OiBlLnBhZ2VYLCB5OiBlLnBhZ2VZfTsKICAgICAgICBsZXQgd2lsbFNjcm9sbEJhclRyYW5zbGF0ZSA9IHRoaXMuc2Nyb2xsQmFyVHJhbnNsYXRlLnkgKyBkZWx0YVk7CiAgICAgICAgLy8g6ZmQ5Yi2c2Nyb2xsIGJhcuenu+WKqOi3neemuwogICAgICAgIGlmICh3aWxsU2Nyb2xsQmFyVHJhbnNsYXRlIDw9IDApIHsKICAgICAgICAgIHRoaXMuc2Nyb2xsQmFyVHJhbnNsYXRlLnkgPSAwOwogICAgICAgIH0gZWxzZSBpZiAod2lsbFNjcm9sbEJhclRyYW5zbGF0ZSA+PSB0aGlzLnNjcm9sbEJhck1heFRyYW5zbGF0ZVkpIHsKICAgICAgICAgIHRoaXMuc2Nyb2xsQmFyVHJhbnNsYXRlLnkgPSB0aGlzLnNjcm9sbEJhck1heFRyYW5zbGF0ZVk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuc2Nyb2xsQmFyVHJhbnNsYXRlLnkgPSB3aWxsU2Nyb2xsQmFyVHJhbnNsYXRlOwogICAgICAgIH0KICAgICAgICB0aGlzLnVwZGF0ZUNvbnRlbnRUcmFuc2xhdGVZQnlNb3VzZSgpOwogICAgICB9CiAgICB9LAogICAgb25Nb3VzZVVwU2Nyb2xsQmFyKGUpIHsKICAgICAgdGhpcy5zY3JvbGxCYXJNb3ZpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5saXN0ZW5Ub0RvYygpOwogICAgfSwKICAgIGxpc3RlblRvRG9jKCkgewogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5vbk1vdXNlVXBTY3JvbGxCYXIpOwogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlU2Nyb2xsQmFyKTsKICAgIH0sCiAgICBvbk1vdXNlRW50ZXIoKSB7CiAgICAgIHRoaXMuc2Nyb2xsQmFyVmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgb25Nb3VzZUxlYXZlKCkgewogICAgICB0aGlzLnNjcm9sbEJhclZpc2libGUgPSBmYWxzZTsKICAgIH0sCiAgICBvbldoZWVsKGV2ZW50KSB7CiAgICAgIHRoaXMudXBkYXRlQ29udGVudFRyYW5zbGF0ZVkoZXZlbnQpOwogICAgICB0aGlzLnVwZGF0ZVNjcm9sbEJhcigpOwogICAgfSwKICAgIHVwZGF0ZUNvbnRlbnRUcmFuc2xhdGVZKGV2ZW50KSB7CiAgICAgIGxldCBkaXJlY3Rpb24gPSBldmVudC5kZWx0YVk7CiAgICAgIC8vIOmZkOWItuWGheWuuea7muWKqOi3neemuwogICAgICBpZiAoZGlyZWN0aW9uID4gMCkgewogICAgICAgIHRoaXMuY29udGVudFRyYW5zbGF0ZVkgLT0gdGhpcy5zdGVwOwogICAgICAgIGlmICh0aGlzLmNvbnRlbnRUcmFuc2xhdGVZIDw9IC10aGlzLmNvbnRlbnRNYXhUcmFuc2xhdGVZKSB7CiAgICAgICAgICB0aGlzLmNvbnRlbnRUcmFuc2xhdGVZID0gLXRoaXMuY29udGVudE1heFRyYW5zbGF0ZVk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA8IDApIHsKICAgICAgICB0aGlzLmNvbnRlbnRUcmFuc2xhdGVZICs9IHRoaXMuc3RlcDsKICAgICAgICBpZiAodGhpcy5jb250ZW50VHJhbnNsYXRlWSA+PSAwKSB7CiAgICAgICAgICB0aGlzLmNvbnRlbnRUcmFuc2xhdGVZID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy/op6PlhrPlhoXlrrnmu5rliqjliLAKICAgICAgbGV0IGxpbWl0ID0gTWF0aC5hYnMoLXRoaXMuY29udGVudFRyYW5zbGF0ZVkpOwogICAgICBpZiAoMCA8IGxpbWl0ICYmIGxpbWl0IDwgdGhpcy5jb250ZW50TWF4VHJhbnNsYXRlWSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0sCiAgICBpbml0KCkgewogICAgICBsZXQgdmlld0JveEVsID0gdGhpcy4kcmVmcy52aWV3Qm94OwogICAgICB0aGlzLmNvbnRlbnRIZWlnaHQgPSB0aGlzLiRyZWZzLmNvbnRlbnQub2Zmc2V0SGVpZ2h0OwogICAgICB0aGlzLnRyYWNrSGVpZ2h0ID0gdmlld0JveEVsLmNsaWVudEhlaWdodDsKICAgICAgdGhpcy52aXNpYmxlSGVpZ2h0ID0gY2FsVmlzaWJsZUhlaWdodCh2aWV3Qm94RWwpOwogICAgICB0aGlzLnVwZGF0ZVNjcm9sbEJhcigpOwogICAgICB0aGlzLmxpc3RlblRvUmVtb3RlUmVzb3VyY2VzKCk7CiAgICAgIHRoaXMubGlzdGVuVG9Eb21DaGFuZ2UoKTsKICAgIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXQoKTsKICB9Cn0K"},{"version":3,"sources":["scroll-view.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scroll-view.vue","sourceRoot":"src/components/scroll-view/src","sourcesContent":["<template>\r\n    <div ref=\"viewBox\" class=\"w-scroll-wrapper\"\r\n         @mouseenter=\"onMouseEnter\"\r\n         @mouseleave=\"onMouseLeave\"\r\n         @wheel=\"onWheel\"\r\n    >\r\n        <div ref=\"content\" class=\"w-scroll\" :style=\"{transform:`translateY(${contentTranslateY}px)`}\">\r\n            <slot></slot>\r\n        </div>\r\n        <div class=\"w-scroll-track\" ref=\"track\" v-if=\"scrollBarVisible\">\r\n            <div class=\"w-scroll-bar\" ref=\"bar\"\r\n                 :style=\"{height:scrollBarHeight+'px',transform:`translate3d(0px,${scrollBarTranslate.y}px,${scrollBarTranslate.z}px)`}\"\r\n                 @mousedown=\"onMouseDownScrollBar\">\r\n                <div class=\"w-scroll-bar-inner\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  import {calVisibleHeight} from \"../../../utils/scroll\";\r\n  export default {\r\n    name: \"WScrollView\",\r\n    props: {\r\n      step: {\r\n        type: Number,\r\n        default: 100\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        trackHeight: 0,\r\n        scrollBarHeight: 0,\r\n        scrollBarVisible: true,\r\n        scrollBarStartPos: {},\r\n        scrollBarMoving: false,\r\n        scrollBarTranslate: {x: 0, y: 0, z: 1},\r\n        contentTranslateY: 0,\r\n        contentHeight: 0,\r\n        visibleHeight: 0,\r\n      }\r\n    },\r\n    computed: {\r\n      contentMaxTranslateY() {\r\n        return this.contentHeight - this.visibleHeight;\r\n      },\r\n      scrollBarMaxTranslateY() {\r\n        return this.trackHeight - this.scrollBarHeight;\r\n      }\r\n    },\r\n    methods: {\r\n      listenToRemoteResources() {\r\n        let tags = this.$refs.viewBox.querySelectorAll('img, video, audio');\r\n        Array.from(tags).map((tag) => {\r\n          if (tag.hasAttribute('data-listened')) {\r\n            return\r\n          }\r\n          tag.setAttribute('data-listened', 'yes');\r\n          tag.addEventListener('load', () => {\r\n            this.init();\r\n          })\r\n        })\r\n      },\r\n      listenToDomChange() {\r\n        const targetNode = this.$refs.content;\r\n        const config = {attributes: true, childList: true, subtree: true};\r\n        const callback = () => {\r\n          this.listenToRemoteResources()\r\n        };\r\n        const observer = new MutationObserver(callback);\r\n        observer.observe(targetNode, config);\r\n      },\r\n      updateScrollBarHeight() {\r\n        this.scrollBarHeight = this.visibleHeight * this.trackHeight / this.contentHeight;\r\n      },\r\n      updateScrollBar() {\r\n        this.updateScrollBarHeight();\r\n        this.scrollBarTranslate.y = -this.contentTranslateY * this.trackHeight / this.contentHeight;\r\n      },\r\n      updateContentTranslateYByMouse() {\r\n        this.contentTranslateY = -this.contentHeight * this.scrollBarTranslate.y / this.visibleHeight;\r\n      },\r\n      onMouseDownScrollBar(e) {\r\n        this.scrollBarMoving = true;\r\n        this.scrollBarStartPos = {x: e.pageX, y: e.pageY};\r\n        document.addEventListener('mousemove', this.onMouseMoveScrollBar);\r\n        document.addEventListener('mouseup', this.onMouseUpScrollBar);\r\n      },\r\n      onMouseMoveScrollBar(e) {\r\n        if (this.scrollBarMoving) {\r\n          let deltaY = e.pageY - this.scrollBarStartPos.y;\r\n          this.scrollBarStartPos = {x: e.pageX, y: e.pageY};\r\n          let willScrollBarTranslate = this.scrollBarTranslate.y + deltaY;\r\n          // 限制scroll bar移动距离\r\n          if (willScrollBarTranslate <= 0) {\r\n            this.scrollBarTranslate.y = 0;\r\n          } else if (willScrollBarTranslate >= this.scrollBarMaxTranslateY) {\r\n            this.scrollBarTranslate.y = this.scrollBarMaxTranslateY;\r\n          } else {\r\n            this.scrollBarTranslate.y = willScrollBarTranslate;\r\n          }\r\n          this.updateContentTranslateYByMouse();\r\n        }\r\n      },\r\n      onMouseUpScrollBar(e) {\r\n        this.scrollBarMoving = false;\r\n        this.listenToDoc();\r\n      },\r\n      listenToDoc() {\r\n        document.removeEventListener('mouseup', this.onMouseUpScrollBar);\r\n        document.removeEventListener('mousemove', this.onMouseMoveScrollBar);\r\n      },\r\n      onMouseEnter() {\r\n        this.scrollBarVisible = true;\r\n      },\r\n      onMouseLeave() {\r\n        this.scrollBarVisible = false;\r\n      },\r\n      onWheel(event) {\r\n        this.updateContentTranslateY(event);\r\n        this.updateScrollBar();\r\n      },\r\n      updateContentTranslateY(event) {\r\n        let direction = event.deltaY;\r\n        // 限制内容滚动距离\r\n        if (direction > 0) {\r\n          this.contentTranslateY -= this.step;\r\n          if (this.contentTranslateY <= -this.contentMaxTranslateY) {\r\n            this.contentTranslateY = -this.contentMaxTranslateY;\r\n          }\r\n        } else if (direction < 0) {\r\n          this.contentTranslateY += this.step;\r\n          if (this.contentTranslateY >= 0) {\r\n            this.contentTranslateY = 0;\r\n          }\r\n        }\r\n        //解决内容滚动到\r\n        let limit = Math.abs(-this.contentTranslateY);\r\n        if (0 < limit && limit < this.contentMaxTranslateY) {\r\n          event.preventDefault();\r\n        }\r\n      },\r\n      init() {\r\n        let viewBoxEl = this.$refs.viewBox;\r\n        this.contentHeight = this.$refs.content.offsetHeight;\r\n        this.trackHeight = viewBoxEl.clientHeight;\r\n        this.visibleHeight = calVisibleHeight(viewBoxEl);\r\n        this.updateScrollBar();\r\n        this.listenToRemoteResources();\r\n        this.listenToDomChange();\r\n      }\r\n    },\r\n    mounted() {\r\n      this.init();\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .w-scroll {\r\n        box-sizing: border-box;\r\n        transition: transform .05s ease-in-out;\r\n        overflow: hidden; //触发BFC\r\n        &-wrapper {\r\n            overflow: hidden;\r\n            position: relative;\r\n            box-sizing: border-box;\r\n        }\r\n        &-track {\r\n            position: absolute;\r\n            width: 14px;\r\n            height: 100%;\r\n            top: 0;\r\n            right: 0;\r\n            background-color: rgba(0, 0, 0, 0.2);\r\n            border-radius: 7px;\r\n            opacity: 0.5;\r\n        }\r\n        &-bar {\r\n            position: absolute;\r\n            width: 8px;\r\n            left: 50%;\r\n            top: 0;\r\n            margin-left: -4px;\r\n            padding: 4px 0;\r\n            transition: all .05s ease-in-out;\r\n            box-sizing: border-box;\r\n            &-inner {\r\n                height: 100%;\r\n                border-radius: 4px;\r\n                background-color: rgba(0, 0, 0, .3);\r\n                transition: background-color .3s ease-in-out;\r\n                cursor: pointer;\r\n                &:hover {\r\n                    background-color: rgba(0, 0, 0, .8);\r\n                }\r\n            }\r\n        }\r\n    }\r\n</style>"]}]}