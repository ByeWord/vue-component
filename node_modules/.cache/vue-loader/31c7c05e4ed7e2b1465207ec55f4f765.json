{"remainingRequest":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\src\\components\\scroll-view\\src\\scroll-view.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\src\\components\\scroll-view\\src\\scroll-view.vue","mtime":1580546204031},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7Y2FsVmlzaWJsZUhlaWdodH0gZnJvbSAiLi4vLi4vLi4vdXRpbHMvc2Nyb2xsIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJXU2Nyb2xsVmlldyIsCiAgcHJvcHM6IHsKICAgIHN0ZXA6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAxMDAKICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0cmFja0hlaWdodDogMCwKICAgICAgc2Nyb2xsQmFySGVpZ2h0OiAwLAogICAgICBzY3JvbGxCYXJWaXNpYmxlOiBmYWxzZSwKICAgICAgc2Nyb2xsQmFyU3RhcnRQb3M6IHt9LAogICAgICBzY3JvbGxCYXJNb3Zpbmc6IGZhbHNlLAogICAgICBzY3JvbGxCYXJUcmFuc2xhdGU6IHt4OiAwLCB5OiAwLCB6OiAxfSwKICAgICAgY29udGVudFRyYW5zbGF0ZVk6IDAsCiAgICAgIGNvbnRlbnRIZWlnaHQ6IDAsCiAgICAgIHZpc2libGVIZWlnaHQ6IDAsCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgY29udGVudE1heFRyYW5zbGF0ZVkoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnRlbnRIZWlnaHQgLSB0aGlzLnZpc2libGVIZWlnaHQ7CiAgICB9LAogICAgc2Nyb2xsQmFyTWF4VHJhbnNsYXRlWSgpIHsKICAgICAgcmV0dXJuIHRoaXMudHJhY2tIZWlnaHQgLSB0aGlzLnNjcm9sbEJhckhlaWdodDsKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGxpc3RlblRvUmVtb3RlUmVzb3VyY2VzKCkgewogICAgICBsZXQgdGFncyA9IHRoaXMuJHJlZnMudmlld0JveC5xdWVyeVNlbGVjdG9yQWxsKCdpbWcsIHZpZGVvLCBhdWRpbycpOwogICAgICBBcnJheS5mcm9tKHRhZ3MpLm1hcCgodGFnKSA9PiB7CiAgICAgICAgaWYgKHRhZy5oYXNBdHRyaWJ1dGUoJ2RhdGEtbGlzdGVuZWQnKSkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHRhZy5zZXRBdHRyaWJ1dGUoJ2RhdGEtbGlzdGVuZWQnLCAneWVzJyk7CiAgICAgICAgdGFnLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7CiAgICAgICAgICB0aGlzLmluaXQoKTsKICAgICAgICB9KQogICAgICB9KQogICAgfSwKICAgIGxpc3RlblRvRG9tQ2hhbmdlKCkgewogICAgICBjb25zdCB0YXJnZXROb2RlID0gdGhpcy4kcmVmcy5jb250ZW50OwogICAgICBjb25zdCBjb25maWcgPSB7YXR0cmlidXRlczogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlfTsKICAgICAgY29uc3QgY2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhpcy5saXN0ZW5Ub1JlbW90ZVJlc291cmNlcygpCiAgICAgIH07CiAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoY2FsbGJhY2spOwogICAgICBvYnNlcnZlci5vYnNlcnZlKHRhcmdldE5vZGUsIGNvbmZpZyk7CiAgICB9LAogICAgdXBkYXRlU2Nyb2xsQmFySGVpZ2h0KCkgewogICAgICB0aGlzLnNjcm9sbEJhckhlaWdodCA9IHRoaXMudmlzaWJsZUhlaWdodCAqIHRoaXMudHJhY2tIZWlnaHQgLyB0aGlzLmNvbnRlbnRIZWlnaHQ7CiAgICB9LAogICAgdXBkYXRlU2Nyb2xsQmFyKCkgewogICAgICB0aGlzLnVwZGF0ZVNjcm9sbEJhckhlaWdodCgpOwogICAgICB0aGlzLnNjcm9sbEJhclRyYW5zbGF0ZS55ID0gLXRoaXMuY29udGVudFRyYW5zbGF0ZVkgKiB0aGlzLnRyYWNrSGVpZ2h0IC8gdGhpcy5jb250ZW50SGVpZ2h0OwogICAgfSwKICAgIHVwZGF0ZUNvbnRlbnRUcmFuc2xhdGVZQnlNb3VzZSgpIHsKICAgICAgdGhpcy5jb250ZW50VHJhbnNsYXRlWSA9IC10aGlzLmNvbnRlbnRIZWlnaHQgKiB0aGlzLnNjcm9sbEJhclRyYW5zbGF0ZS55IC8gdGhpcy52aXNpYmxlSGVpZ2h0OwogICAgfSwKICAgIG9uTW91c2VEb3duU2Nyb2xsQmFyKGUpIHsKICAgICAgdGhpcy5zY3JvbGxCYXJNb3ZpbmcgPSB0cnVlOwogICAgICB0aGlzLnNjcm9sbEJhclN0YXJ0UG9zID0ge3g6IGUucGFnZVgsIHk6IGUucGFnZVl9OwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlU2Nyb2xsQmFyKTsKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwU2Nyb2xsQmFyKTsKICAgIH0sCiAgICBvbk1vdXNlTW92ZVNjcm9sbEJhcihlKSB7CiAgICAgIGlmICh0aGlzLnNjcm9sbEJhck1vdmluZykgewogICAgICAgIGxldCBkZWx0YVkgPSBlLnBhZ2VZIC0gdGhpcy5zY3JvbGxCYXJTdGFydFBvcy55OwogICAgICAgIHRoaXMuc2Nyb2xsQmFyU3RhcnRQb3MgPSB7eDogZS5wYWdlWCwgeTogZS5wYWdlWX07CiAgICAgICAgbGV0IHdpbGxTY3JvbGxCYXJUcmFuc2xhdGUgPSB0aGlzLnNjcm9sbEJhclRyYW5zbGF0ZS55ICsgZGVsdGFZOwogICAgICAgIC8vIOmZkOWItnNjcm9sbCBiYXLnp7vliqjot53nprsKICAgICAgICBpZiAod2lsbFNjcm9sbEJhclRyYW5zbGF0ZSA8PSAwKSB7CiAgICAgICAgICB0aGlzLnNjcm9sbEJhclRyYW5zbGF0ZS55ID0gMDsKICAgICAgICB9IGVsc2UgaWYgKHdpbGxTY3JvbGxCYXJUcmFuc2xhdGUgPj0gdGhpcy5zY3JvbGxCYXJNYXhUcmFuc2xhdGVZKSB7CiAgICAgICAgICB0aGlzLnNjcm9sbEJhclRyYW5zbGF0ZS55ID0gdGhpcy5zY3JvbGxCYXJNYXhUcmFuc2xhdGVZOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnNjcm9sbEJhclRyYW5zbGF0ZS55ID0gd2lsbFNjcm9sbEJhclRyYW5zbGF0ZTsKICAgICAgICB9CiAgICAgICAgdGhpcy51cGRhdGVDb250ZW50VHJhbnNsYXRlWUJ5TW91c2UoKTsKICAgICAgfQogICAgfSwKICAgIG9uTW91c2VVcFNjcm9sbEJhcihlKSB7CiAgICAgIHRoaXMuc2Nyb2xsQmFyTW92aW5nID0gZmFsc2U7CiAgICAgIHRoaXMubGlzdGVuVG9Eb2MoKTsKICAgIH0sCiAgICBsaXN0ZW5Ub0RvYygpIHsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwU2Nyb2xsQmFyKTsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5vbk1vdXNlTW92ZVNjcm9sbEJhcik7CiAgICB9LAogICAgb25Nb3VzZUVudGVyKCkgewogICAgICB0aGlzLnNjcm9sbEJhclZpc2libGUgPSB0cnVlOwogICAgfSwKICAgIG9uTW91c2VMZWF2ZSgpIHsKICAgICAgdGhpcy5zY3JvbGxCYXJWaXNpYmxlID0gZmFsc2U7CiAgICB9LAogICAgb25XaGVlbChldmVudCkgewogICAgICB0aGlzLnVwZGF0ZUNvbnRlbnRUcmFuc2xhdGVZKGV2ZW50KTsKICAgICAgdGhpcy51cGRhdGVTY3JvbGxCYXIoKTsKICAgIH0sCiAgICB1cGRhdGVDb250ZW50VHJhbnNsYXRlWShldmVudCkgewogICAgICBsZXQgZGlyZWN0aW9uID0gZXZlbnQuZGVsdGFZOwogICAgICAvLyDpmZDliLblhoXlrrnmu5rliqjot53nprsKICAgICAgaWYgKGRpcmVjdGlvbiA+IDApIHsKICAgICAgICB0aGlzLmNvbnRlbnRUcmFuc2xhdGVZIC09IHRoaXMuc3RlcDsKICAgICAgICBpZiAodGhpcy5jb250ZW50VHJhbnNsYXRlWSA8PSAtdGhpcy5jb250ZW50TWF4VHJhbnNsYXRlWSkgewogICAgICAgICAgdGhpcy5jb250ZW50VHJhbnNsYXRlWSA9IC10aGlzLmNvbnRlbnRNYXhUcmFuc2xhdGVZOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPCAwKSB7CiAgICAgICAgdGhpcy5jb250ZW50VHJhbnNsYXRlWSArPSB0aGlzLnN0ZXA7CiAgICAgICAgaWYgKHRoaXMuY29udGVudFRyYW5zbGF0ZVkgPj0gMCkgewogICAgICAgICAgdGhpcy5jb250ZW50VHJhbnNsYXRlWSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8v6Kej5Yaz5YaF5a655rua5Yqo5YiwCiAgICAgIGxldCBsaW1pdCA9IE1hdGguYWJzKC10aGlzLmNvbnRlbnRUcmFuc2xhdGVZKTsKICAgICAgaWYgKDAgPCBsaW1pdCAmJiBsaW1pdCA8IHRoaXMuY29udGVudE1heFRyYW5zbGF0ZVkpIHsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9LAogICAgaW5pdCgpIHsKICAgICAgbGV0IHZpZXdCb3hFbCA9IHRoaXMuJHJlZnMudmlld0JveDsKICAgICAgdGhpcy5jb250ZW50SGVpZ2h0ID0gdGhpcy4kcmVmcy5jb250ZW50Lm9mZnNldEhlaWdodDsKICAgICAgdGhpcy50cmFja0hlaWdodCA9IHZpZXdCb3hFbC5jbGllbnRIZWlnaHQ7CiAgICAgIHRoaXMudmlzaWJsZUhlaWdodCA9IGNhbFZpc2libGVIZWlnaHQodmlld0JveEVsKTsKICAgICAgdGhpcy51cGRhdGVTY3JvbGxCYXIoKTsKICAgICAgdGhpcy5saXN0ZW5Ub1JlbW90ZVJlc291cmNlcygpOwogICAgICB0aGlzLmxpc3RlblRvRG9tQ2hhbmdlKCk7CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5pbml0KCk7CiAgfQp9Cg=="},{"version":3,"sources":["scroll-view.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scroll-view.vue","sourceRoot":"src/components/scroll-view/src","sourcesContent":["<template>\r\n    <div ref=\"viewBox\" class=\"w-scroll-wrapper\"\r\n         @mouseenter=\"onMouseEnter\"\r\n         @mouseleave=\"onMouseLeave\"\r\n         @wheel=\"onWheel\"\r\n    >\r\n        <div ref=\"content\" class=\"w-scroll\" :style=\"{transform:`translateY(${contentTranslateY}px)`}\">\r\n            <slot></slot>\r\n        </div>\r\n        <div class=\"w-scroll-track\" ref=\"track\" v-if=\"scrollBarVisible\">\r\n            <div class=\"w-scroll-bar\" ref=\"bar\"\r\n                 :style=\"{height:scrollBarHeight+'px',transform:`translate3d(0px,${scrollBarTranslate.y}px,${scrollBarTranslate.z}px)`}\"\r\n                 @mousedown=\"onMouseDownScrollBar\">\r\n                <div class=\"w-scroll-bar-inner\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  import {calVisibleHeight} from \"../../../utils/scroll\";\r\n  export default {\r\n    name: \"WScrollView\",\r\n    props: {\r\n      step: {\r\n        type: Number,\r\n        default: 100\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        trackHeight: 0,\r\n        scrollBarHeight: 0,\r\n        scrollBarVisible: false,\r\n        scrollBarStartPos: {},\r\n        scrollBarMoving: false,\r\n        scrollBarTranslate: {x: 0, y: 0, z: 1},\r\n        contentTranslateY: 0,\r\n        contentHeight: 0,\r\n        visibleHeight: 0,\r\n      }\r\n    },\r\n    computed: {\r\n      contentMaxTranslateY() {\r\n        return this.contentHeight - this.visibleHeight;\r\n      },\r\n      scrollBarMaxTranslateY() {\r\n        return this.trackHeight - this.scrollBarHeight;\r\n      }\r\n    },\r\n    methods: {\r\n      listenToRemoteResources() {\r\n        let tags = this.$refs.viewBox.querySelectorAll('img, video, audio');\r\n        Array.from(tags).map((tag) => {\r\n          if (tag.hasAttribute('data-listened')) {\r\n            return\r\n          }\r\n          tag.setAttribute('data-listened', 'yes');\r\n          tag.addEventListener('load', () => {\r\n            this.init();\r\n          })\r\n        })\r\n      },\r\n      listenToDomChange() {\r\n        const targetNode = this.$refs.content;\r\n        const config = {attributes: true, childList: true, subtree: true};\r\n        const callback = () => {\r\n          this.listenToRemoteResources()\r\n        };\r\n        const observer = new MutationObserver(callback);\r\n        observer.observe(targetNode, config);\r\n      },\r\n      updateScrollBarHeight() {\r\n        this.scrollBarHeight = this.visibleHeight * this.trackHeight / this.contentHeight;\r\n      },\r\n      updateScrollBar() {\r\n        this.updateScrollBarHeight();\r\n        this.scrollBarTranslate.y = -this.contentTranslateY * this.trackHeight / this.contentHeight;\r\n      },\r\n      updateContentTranslateYByMouse() {\r\n        this.contentTranslateY = -this.contentHeight * this.scrollBarTranslate.y / this.visibleHeight;\r\n      },\r\n      onMouseDownScrollBar(e) {\r\n        this.scrollBarMoving = true;\r\n        this.scrollBarStartPos = {x: e.pageX, y: e.pageY};\r\n        document.addEventListener('mousemove', this.onMouseMoveScrollBar);\r\n        document.addEventListener('mouseup', this.onMouseUpScrollBar);\r\n      },\r\n      onMouseMoveScrollBar(e) {\r\n        if (this.scrollBarMoving) {\r\n          let deltaY = e.pageY - this.scrollBarStartPos.y;\r\n          this.scrollBarStartPos = {x: e.pageX, y: e.pageY};\r\n          let willScrollBarTranslate = this.scrollBarTranslate.y + deltaY;\r\n          // 限制scroll bar移动距离\r\n          if (willScrollBarTranslate <= 0) {\r\n            this.scrollBarTranslate.y = 0;\r\n          } else if (willScrollBarTranslate >= this.scrollBarMaxTranslateY) {\r\n            this.scrollBarTranslate.y = this.scrollBarMaxTranslateY;\r\n          } else {\r\n            this.scrollBarTranslate.y = willScrollBarTranslate;\r\n          }\r\n          this.updateContentTranslateYByMouse();\r\n        }\r\n      },\r\n      onMouseUpScrollBar(e) {\r\n        this.scrollBarMoving = false;\r\n        this.listenToDoc();\r\n      },\r\n      listenToDoc() {\r\n        document.removeEventListener('mouseup', this.onMouseUpScrollBar);\r\n        document.removeEventListener('mousemove', this.onMouseMoveScrollBar);\r\n      },\r\n      onMouseEnter() {\r\n        this.scrollBarVisible = true;\r\n      },\r\n      onMouseLeave() {\r\n        this.scrollBarVisible = false;\r\n      },\r\n      onWheel(event) {\r\n        this.updateContentTranslateY(event);\r\n        this.updateScrollBar();\r\n      },\r\n      updateContentTranslateY(event) {\r\n        let direction = event.deltaY;\r\n        // 限制内容滚动距离\r\n        if (direction > 0) {\r\n          this.contentTranslateY -= this.step;\r\n          if (this.contentTranslateY <= -this.contentMaxTranslateY) {\r\n            this.contentTranslateY = -this.contentMaxTranslateY;\r\n          }\r\n        } else if (direction < 0) {\r\n          this.contentTranslateY += this.step;\r\n          if (this.contentTranslateY >= 0) {\r\n            this.contentTranslateY = 0;\r\n          }\r\n        }\r\n        //解决内容滚动到\r\n        let limit = Math.abs(-this.contentTranslateY);\r\n        if (0 < limit && limit < this.contentMaxTranslateY) {\r\n          event.preventDefault();\r\n        }\r\n      },\r\n      init() {\r\n        let viewBoxEl = this.$refs.viewBox;\r\n        this.contentHeight = this.$refs.content.offsetHeight;\r\n        this.trackHeight = viewBoxEl.clientHeight;\r\n        this.visibleHeight = calVisibleHeight(viewBoxEl);\r\n        this.updateScrollBar();\r\n        this.listenToRemoteResources();\r\n        this.listenToDomChange();\r\n      }\r\n    },\r\n    mounted() {\r\n      this.init();\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .w-scroll {\r\n        box-sizing: border-box;\r\n        transition: transform .05s ease-in-out;\r\n        overflow: hidden; //触发BFC\r\n        &-wrapper {\r\n            overflow: hidden;\r\n            position: relative;\r\n            box-sizing: border-box;\r\n        }\r\n        &-track {\r\n            position: absolute;\r\n            width: 14px;\r\n            height: 100%;\r\n            top: 0;\r\n            right: 0;\r\n            background-color: rgba(0, 0, 0, 0.2);\r\n            border-radius: 7px;\r\n            opacity: 0.5;\r\n        }\r\n        &-bar {\r\n            position: absolute;\r\n            width: 8px;\r\n            left: 50%;\r\n            top: 0;\r\n            margin-left: -4px;\r\n            padding: 4px 0;\r\n            transition: transform .05s ease-in-out;\r\n            box-sizing: border-box;\r\n            &-inner {\r\n                height: 100%;\r\n                border-radius: 4px;\r\n                background-color: rgba(0, 0, 0, .3);\r\n                transition: background-color .3s ease-in-out;\r\n                cursor: pointer;\r\n                &:hover {\r\n                    background-color: rgba(0, 0, 0, .8);\r\n                }\r\n            }\r\n        }\r\n    }\r\n</style>"]}]}