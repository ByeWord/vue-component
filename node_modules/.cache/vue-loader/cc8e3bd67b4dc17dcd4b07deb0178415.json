{"remainingRequest":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\src\\components\\tabs\\scroll.vue?vue&type=style&index=0&id=d1ef3cc4&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\src\\components\\tabs\\scroll.vue","mtime":1579438503979},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WeChain\\Documents\\Programs\\Vue\\vue-component\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi53LXNjcm9sbCB7CiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIC4wNXMgZWFzZS1pbi1vdXQ7CiAgICBvdmVyZmxvdzogaGlkZGVuOyAvL+inpuWPkUJGQwogICAgJi13cmFwcGVyIHsKICAgICAgICBoZWlnaHQ6IDUwMHB4OwogICAgICAgIHdpZHRoOiA0MDBweDsKICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIGJvcmRlcjogMTBweCBzb2xpZCBjcmltc29uOwogICAgfQogICAgJi10cmFjayB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIHdpZHRoOiAxNHB4OwogICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICB0b3A6IDA7CiAgICAgICAgcmlnaHQ6IDA7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwLjIpOwogICAgICAgIGJvcmRlci1yYWRpdXM6IDdweDsKICAgICAgICBvcGFjaXR5OiAwLjU7CiAgICB9CiAgICAmLWJhciB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIHdpZHRoOiA4cHg7CiAgICAgICAgbGVmdDogNTAlOwogICAgICAgIHRvcDogMDsKICAgICAgICBtYXJnaW4tbGVmdDogLTRweDsKICAgICAgICBwYWRkaW5nOiA0cHggMDsKICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gLjA1cyBlYXNlLWluLW91dDsKICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgICYtaW5uZXIgewogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAuMyk7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgLjNzIGVhc2UtaW4tb3V0OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgICY6aG92ZXIgewogICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgwLCAwLCAwLCAuOCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCg=="},{"version":3,"sources":["scroll.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"scroll.vue","sourceRoot":"src/components/tabs","sourcesContent":["<template>\r\n    <div ref=\"viewBox\" class=\"w-scroll-wrapper\"\r\n         @mouseenter=\"onMouseEnter\"\r\n         @mouseleave=\"onMouseLeave\"\r\n         @wheel=\"onWheel\"\r\n    >\r\n        <div ref=\"content\" class=\"w-scroll\" :style=\"{transform:`translateY(${contentTranslateY}px)`}\">\r\n            <slot></slot>\r\n        </div>\r\n        <div class=\"w-scroll-track\" ref=\"track\" v-if=\"scrollBarVisible\">\r\n            <div class=\"w-scroll-bar\" ref=\"bar\"\r\n                 :style=\"{height:scrollBarHeight+'px',transform:`translate3d(0px,${scrollBarTranslate.y}px,${scrollBarTranslate.z}px)`}\"\r\n                 @mousedown=\"onMouseDownScrollBar\">\r\n                <div class=\"w-scroll-bar-inner\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n  import {calVisibleHeight} from \"../../utils/utils\";\r\n\r\n  export default {\r\n    name: \"w-scroll\",\r\n    props: {\r\n      step: {\r\n        type: Number,\r\n        default: 100\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        trackHeight: 0,\r\n        scrollBarHeight: 0,\r\n        scrollBarVisible: false,\r\n        scrollBarStartPos: {},\r\n        scrollBarMoving: false,\r\n        scrollBarTranslate: {x: 0, y: 0, z: 1},\r\n        contentTranslateY: 0,\r\n        contentHeight: 0,\r\n        visibleHeight: 0,\r\n      }\r\n    },\r\n    computed: {\r\n      contentMaxTranslateY() {\r\n        return this.contentHeight - this.visibleHeight;\r\n      },\r\n      scrollBarMaxTranslateY() {\r\n        return this.trackHeight - this.scrollBarHeight;\r\n      }\r\n    },\r\n    methods: {\r\n      listenToRemoteResources() {\r\n        let tags = this.$refs.viewBox.querySelectorAll('img, video, audio');\r\n        Array.from(tags).map((tag) => {\r\n          if (tag.hasAttribute('data-listened')) {\r\n            return\r\n          }\r\n          tag.setAttribute('data-listened', 'yes');\r\n          tag.addEventListener('load', () => {\r\n            this.init();\r\n          })\r\n        })\r\n      },\r\n      listenToDomChange() {\r\n        const targetNode = this.$refs.content;\r\n        const config = {attributes: true, childList: true, subtree: true};\r\n        const callback = () => {\r\n          this.listenToRemoteResources()\r\n        };\r\n        const observer = new MutationObserver(callback);\r\n        observer.observe(targetNode, config);\r\n      },\r\n      updateScrollBarHeight() {\r\n        this.scrollBarHeight = this.visibleHeight * this.trackHeight / this.contentHeight;\r\n      },\r\n      updateScrollBar() {\r\n        this.updateScrollBarHeight();\r\n        this.scrollBarTranslate.y = -this.contentTranslateY * this.trackHeight / this.contentHeight;\r\n      },\r\n      updateContentTranslateYByMouse() {\r\n        this.contentTranslateY = -this.contentHeight * this.scrollBarTranslate.y / this.visibleHeight;\r\n      },\r\n      onMouseDownScrollBar(e) {\r\n        this.scrollBarMoving = true;\r\n        this.scrollBarStartPos = {x: e.pageX, y: e.pageY};\r\n        document.addEventListener('mousemove', this.onMouseMoveScrollBar);\r\n        document.addEventListener('mouseup', this.onMouseUpScrollBar);\r\n      },\r\n      onMouseMoveScrollBar(e) {\r\n        if (this.scrollBarMoving) {\r\n          let deltaY = e.pageY - this.scrollBarStartPos.y;\r\n          this.scrollBarStartPos = {x: e.pageX, y: e.pageY};\r\n\r\n          let willScrollBarTranslate = this.scrollBarTranslate.y + deltaY;\r\n          // 限制scroll bar移动距离\r\n          if (willScrollBarTranslate <= 0) {\r\n            this.scrollBarTranslate.y = 0;\r\n          } else if (willScrollBarTranslate >= this.scrollBarMaxTranslateY) {\r\n            this.scrollBarTranslate.y = this.scrollBarMaxTranslateY;\r\n          } else {\r\n            this.scrollBarTranslate.y = willScrollBarTranslate;\r\n          }\r\n          this.updateContentTranslateYByMouse();\r\n        }\r\n      },\r\n      onMouseUpScrollBar(e) {\r\n        this.scrollBarMoving = false;\r\n        this.listenToDoc();\r\n      },\r\n      listenToDoc() {\r\n        document.removeEventListener('mouseup', this.onMouseUpScrollBar);\r\n        document.removeEventListener('mousemove', this.onMouseMoveScrollBar);\r\n      },\r\n      onMouseEnter() {\r\n        this.scrollBarVisible = true;\r\n      },\r\n      onMouseLeave() {\r\n        this.scrollBarVisible = false;\r\n      },\r\n      onWheel(event) {\r\n        this.updateContentTranslateY(event);\r\n        this.updateScrollBar();\r\n      },\r\n      updateContentTranslateY(event) {\r\n\r\n        let direction = event.deltaY;\r\n\r\n        // 限制内容滚动距离\r\n        if (direction > 0) {\r\n          this.contentTranslateY -= this.step;\r\n          if (this.contentTranslateY <= -this.contentMaxTranslateY) {\r\n            this.contentTranslateY = -this.contentMaxTranslateY;\r\n          }\r\n        } else if (direction < 0) {\r\n          this.contentTranslateY += this.step;\r\n          if (this.contentTranslateY >= 0) {\r\n            this.contentTranslateY = 0;\r\n          }\r\n        }\r\n        //解决内容滚动到\r\n        let limit = Math.abs(-this.contentTranslateY);\r\n        if (0 < limit && limit < this.contentMaxTranslateY) {\r\n          event.preventDefault();\r\n        }\r\n      },\r\n      init() {\r\n        let viewBoxEl = this.$refs.viewBox;\r\n\r\n        this.contentHeight = this.$refs.content.offsetHeight;\r\n\r\n        this.trackHeight = viewBoxEl.clientHeight;\r\n\r\n        this.visibleHeight = calVisibleHeight(viewBoxEl);\r\n\r\n        this.updateScrollBar();\r\n\r\n        this.listenToRemoteResources();\r\n\r\n        this.listenToDomChange();\r\n      }\r\n    },\r\n    mounted() {\r\n      this.init();\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n    .w-scroll {\r\n        box-sizing: border-box;\r\n        transition: transform .05s ease-in-out;\r\n        overflow: hidden; //触发BFC\r\n        &-wrapper {\r\n            height: 500px;\r\n            width: 400px;\r\n            overflow: hidden;\r\n            position: relative;\r\n            box-sizing: border-box;\r\n            border: 10px solid crimson;\r\n        }\r\n        &-track {\r\n            position: absolute;\r\n            width: 14px;\r\n            height: 100%;\r\n            top: 0;\r\n            right: 0;\r\n            background-color: rgba(0, 0, 0, 0.2);\r\n            border-radius: 7px;\r\n            opacity: 0.5;\r\n        }\r\n        &-bar {\r\n            position: absolute;\r\n            width: 8px;\r\n            left: 50%;\r\n            top: 0;\r\n            margin-left: -4px;\r\n            padding: 4px 0;\r\n            transition: transform .05s ease-in-out;\r\n            box-sizing: border-box;\r\n            &-inner {\r\n                height: 100%;\r\n                border-radius: 4px;\r\n                background-color: rgba(0, 0, 0, .3);\r\n                transition: background-color .3s ease-in-out;\r\n                cursor: pointer;\r\n                &:hover {\r\n                    background-color: rgba(0, 0, 0, .8);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n</style>"]}]}